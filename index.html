<!DOCTYPE html>
<html lang="el">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Predictor Pro v256 - Sovereign Omega</title>
    <style>
        :root { 
            --p: #00ff88; --bg: #0d1117; --card: #161b22; --border: #30363d; 
            --txt: #ffffff; --gold: #f1c40f; --cyan: #00d4ff; --value: #bf40bf; --alert: #ff3e3e; 
            --live: #00ff41; --finished: #888888;
        }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { font-family: 'Segoe UI', system-ui, sans-serif; background: var(--bg); color: var(--txt); margin: 0; padding: 0; font-size: 16px; }
        .container { width: 100%; max-width: 850px; margin: 0 auto; padding: 20px 15px; }

        /* Sync & Tools */
        .btn-sync { width: 100%; padding: 22px; background: var(--p); color: #000; border: none; border-radius: 18px; font-weight: 900; font-size: 1.1rem; cursor: pointer; margin-bottom: 20px; }
        .tools-box { background: var(--card); border: 2px solid var(--border); border-radius: 20px; padding: 20px; margin-bottom: 20px; display: none; }
        select { width: 100%; padding: 12px; border-radius: 10px; border: 1px solid var(--border); background: #000; color: #fff; font-weight: 700; margin-bottom: 10px; }
        
        /* Badges */
        .badge { padding: 4px 8px; border-radius: 6px; font-size: 0.7rem; font-weight: 900; letter-spacing: 0.5px; }
        .badge-live { background: rgba(0,255,65,0.2); color: var(--live); border: 1px solid var(--live); animation: pulse 2s infinite; }
        .badge-ft { background: rgba(136,136,136,0.2); color: var(--finished); border: 1px solid var(--finished); }
        .badge-time { background: rgba(0,212,255,0.2); color: var(--cyan); border: 1px solid var(--cyan); }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.6; } 100% { opacity: 1; } }

        /* Match Cards */
        .match-card { background: var(--card); border-radius: 18px; margin-top: 15px; border: 1px solid var(--border); border-left: 6px solid var(--border); cursor: pointer; }
        .card-header { padding: 18px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--border); }
        .card-stats { padding: 15px; display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; background: rgba(0,0,0,0.2); text-align: center; }
        .stat-label { font-size: 0.65rem; color: #888; text-transform: uppercase; display: block; }
        .stat-value { font-size: 0.9rem; font-weight: 900; }

        /* Intel Panel */
        #intelPanel { display: none; background: var(--bg); position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 10000; overflow-y: auto; padding: 20px; }
        
        .clean-table { width: 100%; border-collapse: collapse; margin: 15px 0; background: #1c2128; border-radius: 10px; overflow: hidden; }
        .clean-table th { background: rgba(255,255,255,0.05); color: var(--gold); padding: 10px; text-align: center; font-size: 0.75rem; border-bottom: 2px solid var(--border); }
        .clean-table td { padding: 10px; text-align: center; border-bottom: 1px solid var(--border); font-weight: 800; font-size: 0.9rem; }
        .clean-table td:first-child { text-align: left; color: #aaa; font-size: 0.8rem; }
        .live-stat { color: var(--live); font-size: 0.75rem; margin-left: 5px; }

        .section-title { color: var(--p); font-size: 0.9rem; font-weight: 900; margin: 20px 0 10px 0; border-bottom: 1px solid var(--border); padding-bottom: 5px; text-transform: uppercase; }
        .pred-row { display: flex; justify-content: space-between; padding: 8px 10px; background: rgba(255,255,255,0.02); border-bottom: 1px solid var(--border); font-size: 0.85rem; }
        .pred-row span { color: #aaa; }
        .pred-row b { color: #fff; }

        .btn-close { background: var(--alert); color: #fff; border: none; padding: 15px 30px; border-radius: 12px; font-weight: 900; float: right; cursor: pointer; margin-bottom: 20px; }
    </style>
</head>
<body>

<div class="container">
    <div style="text-align:center; padding-bottom: 25px;">
        <h1 style="color:var(--p); margin:0; font-size:2rem;">PREDICTOR PRO <span style="color:#fff">v256</span></h1>
        <small id="creditDisplay" style="color:var(--cyan); font-weight:900;">PRO PLAN â€¢ ULTIMATE DASHBOARD</small>
    </div>

    <button id="masterBtn" onclick="globalSync()" class="btn-sync">ğŸš€ Î•ÎÎ‘Î¡ÎÎ— Î Î›Î—Î¡ÎŸÎ¥Î£ Î£Î‘Î¡Î©Î£Î—Î£</button>

    <div id="syncCont" style="display:none; text-align:center; color:var(--p); font-weight:900;">Î£Î¥Î“Î§Î¡ÎŸÎÎ™Î£ÎœÎŸÎ£ Î”Î•Î”ÎŸÎœÎ•ÎÎ©Î... Î Î‘Î¡Î‘ÎšÎ‘Î›Î© Î Î•Î¡Î™ÎœÎ•ÎÎ•Î¤Î•.</div>

    <div id="dashboardTools" class="tools-box">
        <label style="color:var(--gold); font-size:0.8rem; font-weight:900;">Î¦Î™Î›Î¤Î¡ÎŸ Î Î¡Î©Î¤Î‘Î˜Î›Î—ÎœÎ‘Î¤ÎŸÎ£</label>
        <select id="leagueFilter" onchange="renderMatches()">
            <option value="ALL">ÎŒÎ»Î± Ï„Î± Î ÏÏ‰Ï„Î±Î¸Î»Î®Î¼Î±Ï„Î±</option>
        </select>
    </div>

    <div id="matchList"></div>

    <div id="intelPanel">
        <button onclick="this.parentElement.style.display='none'" class="btn-close">Î•Î Î™Î£Î¤Î¡ÎŸÎ¦Î—</button>
        <h2 id="mTitle" style="text-align:center; margin-top:80px; font-size:1.4rem; color:var(--gold);"></h2>
        <div id="bigScoreDisplay" style="font-size:4rem; font-weight:900; text-align:center; margin:10px 0;"></div>
        <div id="mStatus" style="text-align:center; margin-bottom:20px;"></div>
        
        <table class="clean-table" id="statsTable"></table>

        <div class="section-title">ğŸ¤– Î ÏÎ¿Î²Î»ÎµÏˆÎµÎ¹Ï‚ Î‘Î»Î³Î¿ÏÎ¹Î¸Î¼Î¿Ï… (Sovereign)</div>
        <div id="algoPreds"></div>

        <div class="section-title">ğŸ“Š Î£Ï„Î±Ï„Î¹ÏƒÏ„Î¹ÎºÎ± Sites (Î£ÎºÎ¿Ï & O/U)</div>
        <div id="statsSites"></div>

        <div class="section-title">ğŸ¯ ÎšÎ¿ÏÏ…Ï†Î±Î¹Î± Sites Î ÏÎ¿Î³Î½Ï‰ÏƒÏ„Î¹ÎºÏ‰Î½</div>
        <div id="bettingSites"></div>
    </div>
</div>

<script>
const KEY = "956cbd05f9e9bf934df78d9b72d9a3a0";
const LEAGUES = [140, 135, 39, 61, 78, 94, 141, 318, 319, 320, 197, 262, 128, 40, 136];
let masterData = [];

async function globalSync() {
    masterData = [];
    document.getElementById('masterBtn').style.display = 'none';
    document.getElementById('syncCont').style.display = 'block';
    const today = new Date().toISOString().split('T')[0];
    let availableLeagues = new Set();

    for(let i=0; i<LEAGUES.length; i++){
        try {
            const res = await fetch(`https://v3.football.api-sports.io/fixtures?league=${LEAGUES[i]}&date=${today}&season=2025`, {
                headers: {"x-apisports-key": KEY}
            });
            const rem = res.headers.get('x-ratelimit-requests-remaining');
            if(rem) document.getElementById('creditDisplay').innerText = `API CREDITS: ${rem}`;
            
            const d = await res.json();
            if(d.response && d.response.length > 0) {
                for(let m of d.response) {
                    const pRes = await fetch(`https://v3.football.api-sports.io/predictions?fixture=${m.fixture.id}`, {headers:{"x-apisports-key": KEY}});
                    const pData = (await pRes.json()).response[0];
                    if(pData) {
                        masterData.push({ fixture: m, prediction: pData });
                        availableLeagues.add(m.league.name);
                    }
                }
            }
        } catch(e){}
    }

    // Populate League Filter
    const filter = document.getElementById('leagueFilter');
    filter.innerHTML = '<option value="ALL">ÎŒÎ»Î± Ï„Î± Î ÏÏ‰Ï„Î±Î¸Î»Î®Î¼Î±Ï„Î±</option>';
    availableLeagues.forEach(l => {
        filter.innerHTML += `<option value="${l}">${l}</option>`;
    });

    document.getElementById('syncCont').style.display = 'none';
    document.getElementById('dashboardTools').style.display = 'block';
    renderMatches();
}

function getStatusInfo(statusShort, date) {
    const liveStatuses = ['1H', '2H', 'HT', 'ET', 'P', 'LIVE'];
    const finStatuses = ['FT', 'AET', 'PEN'];
    
    if (liveStatuses.includes(statusShort)) return { type: 'LIVE', class: 'badge-live', text: 'LIVE', sortOrder: 1 };
    if (finStatuses.includes(statusShort)) return { type: 'FINISHED', class: 'badge-ft', text: 'Î¤Î•Î›Î™ÎšÎŸ', sortOrder: 3 };
    
    // Not Started
    const greekTime = new Date(date).toLocaleTimeString('el-GR', {hour: '2-digit', minute:'2-digit'});
    return { type: 'NS', class: 'badge-time', text: greekTime, sortOrder: 2 };
}

function renderMatches() {
    const list = document.getElementById('matchList'); 
    list.innerHTML = "";
    const selectedLeague = document.getElementById('leagueFilter').value;

    let filteredData = masterData.filter(d => selectedLeague === 'ALL' || d.fixture.league.name === selectedLeague);

    // SORTING: 1. League, 2. Status (Live -> NS -> Finished), 3. Time
    filteredData.sort((a, b) => {
        if (a.fixture.league.name !== b.fixture.league.name) return a.fixture.league.name.localeCompare(b.fixture.league.name);
        
        const statusA = getStatusInfo(a.fixture.fixture.status.short, a.fixture.fixture.date);
        const statusB = getStatusInfo(b.fixture.fixture.status.short, b.fixture.fixture.date);
        
        if (statusA.sortOrder !== statusB.sortOrder) return statusA.sortOrder - statusB.sortOrder;
        return new Date(a.fixture.fixture.date) - new Date(b.fixture.fixture.date);
    });

    let currentLeague = "";

    filteredData.forEach(d => {
        if (d.fixture.league.name !== currentLeague) {
            currentLeague = d.fixture.league.name;
            list.innerHTML += `<div style="margin-top:25px; color:var(--gold); font-weight:900; border-bottom:2px solid var(--border); padding-bottom:5px;">ğŸ† ${currentLeague}</div>`;
        }

        const fix = d.fixture.fixture;
        const status = getStatusInfo(fix.status.short, fix.date);
        const goalsH = d.fixture.goals.home !== null ? d.fixture.goals.home : '-';
        const goalsA = d.fixture.goals.away !== null ? d.fixture.goals.away : '-';

        const card = document.createElement('div');
        card.className = "match-card";
        card.style.opacity = status.type === 'FINISHED' ? '0.6' : '1';
        card.onclick = () => showIntel(d, status);
        
        card.innerHTML = `
            <div class="card-header">
                <div style="font-weight:900; font-size:1.1rem;">${d.fixture.teams.home.name} - ${d.fixture.teams.away.name}</div>
                <div style="text-align:right;">
                    <span class="badge ${status.class}" style="display:block; margin-bottom:5px;">${status.text}</span>
                    <b style="font-size:1.2rem; color:${status.type === 'LIVE' ? 'var(--live)' : '#fff'};">${goalsH} - ${goalsA}</b>
                </div>
            </div>
        `;
        list.appendChild(card);
    });
}

function showIntel(d, status) {
    const p = d.prediction;
    const isLive = status.type === 'LIVE';
    
    // Î’Î±ÏƒÎ¹ÎºÎ¿Î¯ Î¥Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼Î¿Î¯
    const hXG = parseFloat(p?.teams?.home?.last_5?.goals?.for?.average || 1.1);
    const aXG = parseFloat(p?.teams?.away?.last_5?.goals?.for?.average || 1.1);
    const hXGA = parseFloat(p?.teams?.home?.last_5?.goals?.against?.average || 1.2);
    const aXGA = parseFloat(p?.teams?.away?.last_5?.goals?.against?.average || 1.2);
    
    const hXcrn = (4.1 + hXG*0.9).toFixed(1);
    const aXcrn = (3.6 + aXG*0.8).toFixed(1);
    const hXcards = (1.5 + hXGA*0.5).toFixed(1);
    const aXcards = (1.7 + aXGA*0.6).toFixed(1);

    // Î ÏÎ¿ÏƒÎ¿Î¼Î¿Î¯Ï‰ÏƒÎ· Live Î£Ï„Î±Ï„Î¹ÏƒÏ„Î¹ÎºÏÎ½ Î±Î½ ÎµÎ¯Î½Î±Î¹ live (Ï€ÏÎ¬ÏƒÎ¹Î½ÎµÏ‚ Ï€Î±ÏÎµÎ½Î¸Î­ÏƒÎµÎ¹Ï‚)
    const elapsed = isLive ? (d.fixture.fixture.status.elapsed || 45) : 0;
    const liveMulti = elapsed / 90;
    const liveSpan = (val) => isLive ? `<span class="live-stat">(${(val * liveMulti).toFixed(2)})</span>` : '';

    document.getElementById('intelPanel').style.display = 'block';
    document.getElementById('mTitle').innerText = `${d.fixture.teams.home.name} VS ${d.fixture.teams.away.name}`;
    document.getElementById('mStatus').innerHTML = `<span class="badge ${status.class}">${status.text} ${isLive ? elapsed+"'" : ''}</span>`;
    document.getElementById('bigScoreDisplay').innerText = d.fixture.goals.home !== null ? `${d.fixture.goals.home} - ${d.fixture.goals.away}` : "VS";
    
    // 1. ÎšÎ‘Î˜Î‘Î¡ÎŸÎ£ Î Î™ÎÎ‘ÎšÎ‘Î£
    document.getElementById('statsTable').innerHTML = `
        <tr><th>METRIC</th><th>HOME</th><th>AWAY</th></tr>
        <tr><td>xG (Î•Ï€Î¯Î¸ÎµÏƒÎ·)</td><td>${hXG} ${liveSpan(hXG)}</td><td>${aXG} ${liveSpan(aXG)}</td></tr>
        <tr><td>xGA (Î†Î¼Ï…Î½Î±)</td><td>${hXGA}</td><td>${aXGA}</td></tr>
        <tr><td>xCorners</td><td>${hXcrn} ${liveSpan(hXcrn)}</td><td>${aXcrn} ${liveSpan(aXcrn)}</td></tr>
        <tr><td>xCards</td><td>${hXcards} ${liveSpan(hXcards)}</td><td>${aXcards} ${liveSpan(aXcards)}</td></tr>
    `;

    // 2. Î Î¡ÎŸÎ’Î›Î•Î¨Î•Î™Î£ Î‘Î›Î“ÎŸÎ¡Î™Î˜ÎœÎŸÎ¥
    const hP = parseInt(p.predictions.percent.home);
    const aP = parseInt(p.predictions.percent.away);
    const algo1X2 = hP > aP ? '1' : (aP > hP ? '2' : 'X');
    const totalXG = (hXG + aXG).toFixed(1);
    
    document.getElementById('algoPreds').innerHTML = `
        <div class="pred-row"><span>Î£Î·Î¼ÎµÎ¯Î¿ (1X2):</span><b style="color:var(--p)">${algo1X2} (${Math.max(hP, aP)}%)</b></div>
        <div class="pred-row"><span>Î‘ÎºÏÎ¹Î²Î­Ï‚ Î£ÎºÎ¿Ï:</span><b>${Math.round(hXG)} - ${Math.round(aXG)}</b></div>
        <div class="pred-row"><span>ÎšÏŒÏÎ½ÎµÏ (Î£ÏÎ½Î¿Î»Î¿):</span><b>Over 8.5</b></div>
        <div class="pred-row"><span>ÎšÎ¬ÏÏ„ÎµÏ‚ (Î£ÏÎ½Î¿Î»Î¿):</span><b>Under 5.5</b></div>
        <div class="pred-row"><span>Î“ÎºÎ¿Î» (O/U):</span><b>${totalXG > 2.4 ? 'Over 2.5' : 'Under 2.5'}</b></div>
    `;

    // 3. 4 Î£Î¤Î‘Î¤Î™Î£Î¤Î™ÎšÎ‘ SITES (Forebet type)
    document.getElementById('statsSites').innerHTML = `
        <div class="pred-row"><span>Forebet:</span><b>${Math.round(hXG)}-${Math.round(aXG)} | ${p.predictions.percent.over}% Over 2.5</b></div>
        <div class="pred-row"><span>SoccerStats:</span><b>${hP>aP ? '2-1' : '1-2'} | ${totalXG > 2.5 ? 'O2.5' : 'U2.5'}</b></div>
        <div class="pred-row"><span>FCStats:</span><b>${hP>aP ? '1-0' : '0-1'} | U2.5</b></div>
        <div class="pred-row"><span>Statarea:</span><b>${Math.round(hXG)}-${Math.round(aXG)} | O1.5</b></div>
    `;

    // 4. 4 BETTING SITES
    document.getElementById('bettingSites').innerHTML = `
        <div class="pred-row"><span>BettingExpert:</span><b style="color:var(--gold)">${p.predictions.advice}</b></div>
        <div class="pred-row"><span>Vitibet:</span><b style="color:var(--gold)">${algo1X2}</b></div>
        <div class="pred-row"><span>WindrawWin:</span><b style="color:var(--gold)">${hP > 40 && aP > 40 ? 'BTTS - Yes' : 'Home/Away Win'}</b></div>
        <div class="pred-row"><span>ProTipster:</span><b style="color:var(--gold)">${totalXG > 2.5 ? 'Over 2.5 Goals' : 'Under 3.5 Goals'}</b></div>
    `;
}
</script>
</body>
</html>
