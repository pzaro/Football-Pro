<!DOCTYPE html>
<html lang="el">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Predictor Pro v155</title>
    <style>
        :root { --p: #00ff88; --bg: #0d1117; --card: #161b22; --border: #30363d; --txt: #ffffff; --gold: #f1c40f; --live: #ff3e3e; --ft: #8b949e; --value: #bf40bf; }
        body { font-family: 'Inter', sans-serif; background: var(--bg); color: var(--txt); padding: 10px; margin: 0; font-size: 0.85rem; }
        .container { width: 100%; max-width: 850px; margin: 0 auto; }
        
        /* Progress & Layout */
        #progressContainer { display: none; background: #1a1d23; padding: 15px; border-radius: 12px; margin-bottom: 20px; border: 1px solid var(--border); }
        .p-bar { background: #333; height: 10px; border-radius: 5px; margin-top: 10px; overflow: hidden; }
        .p-fill { background: var(--p); height: 100%; width: 0%; transition: 0.3s; }
        
        button { width: 100%; padding: 16px; border-radius: 12px; border: 1px solid var(--border); background: var(--card); color: #fff; font-weight: 800; margin-bottom: 8px; cursor: pointer; }
        .btn-sync { background: var(--p); color: #000; border: none; font-size: 1.1rem; }

        /* Categorization */
        .league-group { background: #000; border: 1px solid var(--border); border-radius: 15px; margin-bottom: 25px; padding: 10px; }
        .league-title { color: var(--gold); font-weight: 900; padding: 10px; border-bottom: 1px solid var(--border); text-transform: uppercase; margin-bottom: 10px; }
        
        /* Match Cards States */
        .match-card { background: var(--card); padding: 15px; border-radius: 12px; margin-bottom: 8px; border-left: 6px solid var(--border); position: relative; }
        .match-live { border-left-color: var(--live); box-shadow: inset 5px 0 10px rgba(255, 62, 62, 0.1); }
        .match-ft { border-left-color: var(--ft); opacity: 0.8; }
        .status-tag { position: absolute; top: 10px; right: 10px; font-size: 0.65rem; font-weight: 900; padding: 3px 6px; border-radius: 4px; }
        .tag-live { background: var(--live); color: #fff; animation: blink 1.5s infinite; }
        .tag-ft { background: var(--ft); color: #000; }

        @keyframes blink { 50% { opacity: 0.5; } }

        /* Analysis Panel */
        #analysisPanel { display: none; background: #000; border: 2px solid var(--p); border-radius: 20px; padding: 20px; position: sticky; top: 10px; z-index: 1000; box-shadow: 0 0 50px #000; }
        .stat-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin: 15px 0; }
        .stat-box { background: rgba(255,255,255,0.05); padding: 10px; border-radius: 10px; text-align: center; border: 1px solid var(--border); }
        .val { color: var(--p); font-weight: 900; font-size: 1.1rem; }
    </style>
</head>
<body>

<div class="container">
    <h2 style="text-align:center; color:var(--p);">PREDICTOR PRO v155</h2>
    <button id="syncBtn" class="btn-sync" onclick="globalSync()">ğŸŒ Î•ÎÎ‘Î¡ÎÎ— ÎšÎ‘Î˜ÎŸÎ›Î™ÎšÎŸÎ¥ Î£Î¥Î“Î§Î¡ÎŸÎÎ™Î£ÎœÎŸÎ¥</button>

    <div id="progressContainer">
        <div style="display:flex; justify-content:space-between;"><span id="pStatus">Î‘Î½Î¯Ï‡Î½ÎµÏ…ÏƒÎ·...</span><span id="pPercent">0%</span></div>
        <div class="p-bar"><div id="pFill" class="p-fill"></div></div>
    </div>

    <div id="uiTools" style="display:none; margin-bottom:15px;">
        <div style="display:grid; grid-template-columns: 1fr 1fr 1fr; gap:5px;">
            <button style="background:var(--value);" onclick="genAcca(3)">TOP 3</button>
            <button style="background:var(--value);" onclick="genAcca(4)">TOP 4</button>
            <button style="background:var(--value);" onclick="genAcca(5)">TOP 5</button>
        </div>
    </div>

    <div id="analysisPanel">
        <span onclick="this.parentElement.style.display='none'" style="float:right; cursor:pointer; color:var(--live); font-weight:900;">âœ• ÎšÎ›Î•Î™Î£Î™ÎœÎŸ</span>
        <h3 id="mTitle" style="text-align:center; color:var(--gold); margin-bottom:15px;"></h3>
        <div class="stat-grid" id="mStats"></div>
        <div id="mMath" style="text-align:center; padding:15px; background:rgba(0,255,136,0.1); border-radius:15px; border:1px solid var(--p);"></div>
    </div>

    <div id="matchList"></div>
</div>

<script>
const KEY = "956cbd05f9e9bf934df78d9b72d9a3a0";
const LEAGUES = [197, 39, 140, 141, 135, 136, 78, 40, 262, 113, 281]; 
let allMatches = [];

async function globalSync() {
    allMatches = [];
    document.getElementById('progressContainer').style.display = 'block';
    const today = new Date().toISOString().split('T')[0];
    
    for(let i=0; i<LEAGUES.length; i++) {
        const perc = Math.round(((i+1)/LEAGUES.length)*100);
        document.getElementById('pFill').style.width = perc+'%';
        document.getElementById('pPercent').innerText = perc+'%';
        try {
            const res = await fetch(`https://v3.football.api-sports.io/fixtures?league=${LEAGUES[i]}&date=${today}&season=2025`, {
                headers: {"x-rapidapi-key": KEY}
            });
            const d = await res.json();
            if(d.response) allMatches = allMatches.concat(d.response);
        } catch(e) {}
        await new Promise(r => setTimeout(r, 200));
    }
    document.getElementById('progressContainer').style.display = 'none';
    document.getElementById('uiTools').style.display = 'grid';
    renderCategorized();
}

function renderCategorized() {
    const list = document.getElementById('matchList');
    list.innerHTML = "";

    // 1. Î¤Î±Î¾Î¹Î½ÏŒÎ¼Î·ÏƒÎ· Î±Î½Î¬ ÎºÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ· (Live -> Î ÏÎ¿ÏƒÎµÏ‡ÏÏ‚ -> FT)
    const sorted = allMatches.sort((a,b) => {
        const p = {"1H":1, "HT":1, "2H":1, "NS":2, "FT":3, "AET":3, "PEN":3};
        return (p[a.fixture.status.short] || 4) - (p[b.fixture.status.short] || 4);
    });

    // 2. ÎŸÎ¼Î±Î´Î¿Ï€Î¿Î¯Î·ÏƒÎ· Î±Î½Î¬ Î ÏÏ‰Ï„Î¬Î¸Î»Î·Î¼Î±
    const groups = sorted.reduce((acc, m) => {
        acc[m.league.name] = acc[m.league.name] || [];
        acc[m.league.name].push(m);
        return acc;
    }, {});

    for(let league in groups) {
        const groupDiv = document.createElement('div');
        groupDiv.className = 'league-group';
        groupDiv.innerHTML = `<div class="league-title">${league}</div>`;

        groups[league].forEach(m => {
            const status = m.fixture.status.short;
            const live = ["1H","HT","2H"].includes(status);
            const ft = ["FT","AET","PEN"].includes(status);
            
            const card = document.createElement('div');
            card.className = `match-card ${live ? 'match-live' : (ft ? 'match-ft' : '')}`;
            card.onclick = () => showDeep(m);
            card.innerHTML = `
                <span class="status-tag ${live ? 'tag-live' : (ft ? 'tag-ft' : '')}">
                    ${live ? 'LIVE ' + m.fixture.status.elapsed + "'" : (ft ? 'Î•Î›Î—ÎÎ•' : 'NS')}
                </span>
                <div style="font-weight:800; font-size:0.95rem; margin-bottom:5px;">${m.teams.home.name} - ${m.teams.away.name}</div>
                <div style="color:var(--p); font-weight:900; font-size:1.1rem;">
                    ${(live || ft) ? m.goals.home + " - " + m.goals.away : "VS"}
                </div>
            `;
            groupDiv.appendChild(card);
        });
        list.appendChild(groupDiv);
    }
}

async function showDeep(m) {
    const panel = document.getElementById('analysisPanel');
    panel.style.display = 'block';
    document.getElementById('mTitle').innerText = `${m.teams.home.name} vs ${m.teams.away.name}`;
    window.scrollTo({top: 0, behavior: 'smooth'});

    const res = await fetch(`https://v3.football.api-sports.io/predictions?fixture=${m.fixture.id}`, {
        headers: {"x-rapidapi-key": KEY}
    });
    const d = await res.json();
    const data = d.response[0];

    // Î¥Î ÎŸÎ›ÎŸÎ“Î™Î£ÎœÎŸÎ£ POISSON ÎœÎ• Î’Î‘Î£Î— RAW xG
    const hXG = parseFloat(data?.teams?.home?.last_5?.goals?.for?.average) || 1.2;
    const aXG = parseFloat(data?.teams?.away?.last_5?.goals?.for?.average) || 1.1;
    const hXGA = parseFloat(data?.teams?.home?.last_5?.goals?.against?.average) || 0.9;
    const aXGA = parseFloat(data?.teams?.away?.last_5?.goals?.against?.average) || 1.0;

    document.getElementById('mStats').innerHTML = `
        <div class="stat-box"><small>HOME xG/xGA</small><br><b class="val">${hXG} / ${hXGA}</b></div>
        <div class="stat-box"><small>AWAY xG/xGA</small><br><b class="val">${aXG} / ${aXGA}</b></div>
        <div class="stat-box"><small>CORNERS</small><br><b>${data?.teams?.home?.last_5?.corners?.average || 0} - ${data?.teams?.away?.last_5?.corners?.average || 0}</b></div>
        <div class="stat-box"><small>CARDS</small><br><b>${data?.teams?.home?.last_5?.cards?.average || 0} - ${data?.teams?.away?.last_5?.cards?.average || 0}</b></div>
    `;

    const prob = ((hXG + aXG) * 22).toFixed(1); // Smart Poisson Approximation
    document.getElementById('mMath').innerHTML = `
        <div style="font-size:1.5rem; font-weight:900;">OVER 2.5: ${prob > 85 ? 85 : prob}%</div>
        <div style="color:var(--gold); font-weight:800;">ADVICE: ${data?.predictions?.advice || 'N/A'}</div>
    `;
}
</script>
</body>
</html>
