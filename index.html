<!DOCTYPE html>
<html lang="el">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Predictor Pro v157 - Comparison Engine</title>
    <style>
        :root { --p: #00ff88; --bg: #0d1117; --card: #161b22; --border: #30363d; --txt: #ffffff; --gold: #f1c40f; --live: #ff3e3e; --value: #bf40bf; }
        body { font-family: 'Inter', sans-serif; background: var(--bg); color: var(--txt); padding: 10px; margin: 0; font-size: 0.85rem; }
        .container { width: 100%; max-width: 900px; margin: 0 auto; }
        
        /* Analysis Panel */
        #intelPanel { display: none; background: #000; border: 2px solid var(--p); border-radius: 20px; padding: 20px; position: sticky; top: 10px; z-index: 1000; box-shadow: 0 0 60px #000; }
        
        /* Comparison Table */
        .comp-table { width: 100%; border-collapse: collapse; margin-top: 15px; font-size: 0.8rem; }
        .comp-table th { color: var(--gold); text-align: left; padding: 8px; border-bottom: 1px solid #333; }
        .comp-table td { padding: 10px 8px; border-bottom: 1px solid #222; }
        
        .delta-tag { font-weight: 900; padding: 2px 6px; border-radius: 4px; }
        .plus { background: rgba(0, 255, 136, 0.2); color: var(--p); }
        .minus { background: rgba(255, 62, 62, 0.2); color: var(--live); }

        .live-radar { background: rgba(255, 62, 62, 0.05); border: 2px solid var(--live); border-radius: 20px; padding: 15px; margin-bottom: 20px; }
        .match-card { background: var(--card); padding: 15px; border-radius: 12px; margin-bottom: 8px; cursor: pointer; border-left: 5px solid var(--border); }
        button { width: 100%; padding: 16px; border-radius: 12px; border: none; background: var(--p); color: #000; font-weight: 900; cursor: pointer; }
    </style>
</head>
<body>

<div class="container">
    <h2 style="text-align:center; color:var(--p);">PREDICTOR PRO v157</h2>
    <button onclick="globalSync()">ğŸŒ Î£Î¥Î“Î§Î¡ÎŸÎÎ™Î£ÎœÎŸÎ£ & LIVE COMPARISON</button>

    <div id="liveRadar" class="live-radar" style="display:none; margin-top:15px;">
        <div style="color:var(--live); font-weight:900; margin-bottom:10px;">ğŸ“¡ GLOBAL LIVE RADAR</div>
        <div id="liveList"></div>
    </div>

    <div id="intelPanel">
        <span onclick="this.parentElement.style.display='none'" style="float:right; cursor:pointer; color:var(--live); font-weight:900;">âœ• CLOSE</span>
        <h3 id="matchHeader" style="text-align:center; color:var(--gold); margin-bottom:15px;"></h3>
        
        <table class="comp-table">
            <thead>
                <tr>
                    <th>ÎšÎ‘Î¤Î—Î“ÎŸÎ¡Î™Î‘</th>
                    <th>PRE-MATCH</th>
                    <th>LIVE</th>
                    <th>Î‘Î ÎŸÎšÎ›Î™Î£Î— (Î”)</th>
                </tr>
            </thead>
            <tbody id="comparisonBody"></tbody>
        </table>

        <div id="liveAdvice" style="margin-top:20px; padding:15px; border-radius:15px; background:rgba(191, 64, 191, 0.1); border:1px solid var(--value); text-align:center;"></div>
    </div>

    <div id="leagueMatches"></div>
</div>

<script>
const KEY = "956cbd05f9e9bf934df78d9b72d9a3a0";
const LEAGUES = [197, 39, 140, 141, 135, 136, 78, 281];
let allMatches = [];

async function globalSync() {
    allMatches = [];
    const today = new Date().toISOString().split('T')[0];
    for(let id of LEAGUES) {
        const res = await fetch(`https://v3.football.api-sports.io/fixtures?league=${id}&date=${today}&season=2025`, {
            headers: {"x-rapidapi-key": KEY}
        });
        const d = await res.json();
        if(d.response) allMatches = allMatches.concat(d.response);
        await new Promise(r => setTimeout(r, 200));
    }
    renderStructure();
}

function renderStructure() {
    const radar = document.getElementById('liveList');
    const leagueCont = document.getElementById('leagueMatches');
    radar.innerHTML = ""; leagueCont.innerHTML = "";

    const liveMatches = allMatches.filter(m => ["1H","HT","2H"].includes(m.fixture.status.short));
    if(liveMatches.length > 0) {
        document.getElementById('liveRadar').style.display = 'block';
        liveMatches.forEach(m => radar.appendChild(createCard(m)));
    }

    const grouped = allMatches.reduce((acc, m) => {
        acc[m.league.name] = acc[m.league.name] || [];
        acc[m.league.name].push(m);
        return acc;
    }, {});

    for(let league in grouped) {
        const div = document.createElement('div');
        div.innerHTML = `<div style="color:var(--gold); padding:10px; font-weight:900;">${league}</div>`;
        grouped[league].forEach(m => div.appendChild(createCard(m)));
        leagueCont.appendChild(div);
    }
}

function createCard(m) {
    const live = ["1H","HT","2H"].includes(m.fixture.status.short);
    const div = document.createElement('div');
    div.className = 'match-card';
    div.onclick = () => showComparison(m);
    div.innerHTML = `<b>${m.teams.home.name} - ${m.teams.away.name}</b> <span style="float:right; color:var(--p);">${m.goals.home}-${m.goals.away} (${live ? m.fixture.status.elapsed+"'" : "NS"})</span>`;
    return div;
}

async function showComparison(m) {
    document.getElementById('intelPanel').style.display = 'block';
    document.getElementById('matchHeader').innerText = `${m.teams.home.name} vs ${m.teams.away.name}`;
    window.scrollTo({top: 0, behavior: 'smooth'});

    const [predRes, statsRes] = await Promise.all([
        fetch(`https://v3.football.api-sports.io/predictions?fixture=${m.fixture.id}`, {headers:{"x-rapidapi-key":KEY}}),
        fetch(`https://v3.football.api-sports.io/fixtures/statistics?fixture=${m.fixture.id}`, {headers:{"x-rapidapi-key":KEY}})
    ]);

    const pred = (await predRes.json()).response[0];
    const live = (await statsRes.json()).response;

    const time = m.fixture.status.elapsed || 1;
    const factor = time / 90;

    // PRE-MATCH VALUES (Derived from API averages)
    const pGoals = (parseFloat(pred?.predictions?.goals?.over) / 40) || 2.5;
    const pCorners = (parseFloat(pred?.teams?.home?.last_5?.corners?.average) || 4.5) + (parseFloat(pred?.teams?.away?.last_5?.corners?.average) || 4.1);
    const pCards = (parseFloat(pred?.teams?.home?.last_5?.cards?.average) || 2.2) + (parseFloat(pred?.teams?.away?.last_5?.cards?.average) || 2.4);

    // LIVE VALUES
    let lGoals = (m.goals.home + m.goals.away);
    let lCorners = 0, lCards = 0;

    if(live && live.length > 0) {
        lCorners = (live[0].statistics.find(s=>s.type==="Corner Kicks").value || 0) + (live[1].statistics.find(s=>s.type==="Corner Kicks").value || 0);
        lCards = (live[0].statistics.find(s=>s.type==="Yellow Cards").value || 0) + (live[1].statistics.find(s=>s.type==="Yellow Cards").value || 0);
    }

    // DELTA CALCULATION
    const dGoals = (lGoals - (pGoals * factor)).toFixed(2);
    const dCorners = (lCorners - (pCorners * factor)).toFixed(2);
    const dCards = (lCards - (pCards * factor)).toFixed(2);

    document.getElementById('comparisonBody').innerHTML = `
        <tr><td>Î“ÎšÎŸÎ›</td><td>${pGoals.toFixed(1)}</td><td>${lGoals}</td><td><span class="delta-tag ${dGoals < 0 ? 'minus' : 'plus'}">${dGoals}</span></td></tr>
        <tr><td>ÎšÎŸÎ¡ÎÎ•Î¡</td><td>${pCorners.toFixed(1)}</td><td>${lCorners}</td><td><span class="delta-tag ${dCorners < 0 ? 'minus' : 'plus'}">${dCorners}</span></td></tr>
        <tr><td>ÎšÎ‘Î¡Î¤Î•Î£</td><td>${pCards.toFixed(1)}</td><td>${lCards}</td><td><span class="delta-tag ${dCards < 0 ? 'minus' : 'plus'}">${dCards}</span></td></tr>
    `;

    // LIVE ADVICE LOGIC
    let advice = "âš–ï¸ Î¤ÎŸ ÎœÎ‘Î¤Î£ Î•ÎÎ•Î›Î™Î£Î£Î•Î¤Î‘Î™ ÎŸÎœÎ‘Î›Î‘";
    if(dGoals < -0.6) advice = "âš ï¸ VALUE: Î¤ÎŸ ÎœÎ‘Î¤Î£ Î§Î¡Î©Î£Î¤Î‘Î•Î™ Î“ÎšÎŸÎ› (OVER 0.5/1.5)";
    else if(dCorners > 1.5) advice = "ğŸš© HOT: Î¥Î¨Î—Î›ÎŸÎ£ Î¡Î¥Î˜ÎœÎŸÎ£ ÎšÎŸÎ¡ÎÎ•Î¡ (OVER LINE)";
    else if(dCards > 1.0) advice = "ğŸŸ¨ Î•ÎÎ¤Î‘Î£Î—: Î ÎŸÎ›Î›Î•Î£ ÎšÎ‘Î¡Î¤Î•Î£ (Î Î™Î˜Î‘ÎÎ— ÎšÎŸÎšÎšÎ™ÎÎ—)";

    document.getElementById('liveAdvice').innerHTML = `<b>ADVISOR:</b><br>${advice}`;
}
</script>
</body>
</html>
